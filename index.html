<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gerador de Planilha Mestra - Unificado</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        />
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <header>
            <h1>
                <i class="fas fa-file-csv" style="margin-right: 12px"></i>
                Conversor Mestre TXT para Planilha CSV
            </h1>
            <p>
                <i
                    class="fas fa-magic"
                    style="margin-right: 8px; opacity: 0.9"
                ></i>
                Processe lotes de dados de dias diferentes e gere uma planilha
                consolidada com facilidade
            </p>

            <button id="btnAjuda" class="help-icon" title="Ajuda e Instru√ß√µes">
                <i class="fas fa-question-circle"></i>
            </button>

            <button
                id="btnToggleTema"
                class="theme-toggle"
                title="Alternar Tema"
            >
                <i class="fas fa-moon" id="iconTema"></i>
            </button>
        </header>

        <main class="container">
            <section class="controls-panel">
                <h2>
                    <i
                        class="fas fa-cog"
                        style="margin-right: 10px; color: var(--color-primary)"
                    ></i>
                    Configura√ß√£o do Processamento
                </h2>

                <!-- Seletor de Tipo -->
                <div class="input-group">
                    <label for="tipoProcessamento"
                        >**Tipo de Processamento:**</label
                    >
                    <select id="tipoProcessamento" class="select-input">
                        <option value="CAC">
                            CAC - Consultor (Campos: Consultor, Matricula,
                            Motivo, Contrato/CNPJ, Banco, Liga√ß√£o, Omni,
                            Refer√™ncia)
                        </option>
                        <option value="CAB">
                            CAB - Banc√°rio (Campos: Banc√°rio, CPF, Ag√™ncia,
                            Banco, Produto, CNPJ/Contrato, Motivo, Evento,
                            Descri√ß√£o, Omni, Refer√™ncia)
                        </option>
                        <option value="CUSTOM">
                            CUSTOM - Personalizado (Defina suas pr√≥prias
                            colunas)
                        </option>
                    </select>
                </div>

                <!-- Painel de Configura√ß√£o de Colunas (apenas para CUSTOM) -->
                <div
                    id="painelColunas"
                    class="painel-colunas"
                    style="display: none"
                >
                    <h3>
                        <i
                            class="fas fa-columns"
                            style="
                                margin-right: 8px;
                                color: var(--color-primary);
                            "
                        ></i>
                        Configura√ß√£o de Colunas Personalizadas
                    </h3>
                    <p class="info-text">
                        Defina os campos que ser√£o extra√≠dos do arquivo TXT. Use
                        o formato: "NomeCampo: valor" no arquivo.
                    </p>

                    <!-- √Årea de Upload de Modelo -->
                    <div
                        class="input-group"
                        style="
                            margin-bottom: 20px;
                            padding: 20px;
                            background: linear-gradient(
                                135deg,
                                #f0f9ff 0%,
                                #e0f2fe 100%
                            );
                            border-radius: 12px;
                            border: 2px dashed var(--color-primary);
                        "
                    >
                        <label
                            style="
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                margin-bottom: 10px;
                            "
                        >
                            <i
                                class="fas fa-upload"
                                style="color: var(--color-primary)"
                            ></i>
                            <strong
                                >Carregar Arquivo TXT como Modelo
                                (Opcional)</strong
                            >
                        </label>
                        <input
                            type="file"
                            id="uploadModelo"
                            accept=".txt"
                            style="margin-bottom: 10px"
                        />
                        <p
                            style="
                                margin: 0;
                                font-size: 0.85em;
                                color: var(--color-text-secondary);
                            "
                        >
                            <i
                                class="fas fa-lightbulb"
                                style="
                                    margin-right: 5px;
                                    color: var(--color-accent);
                                "
                            ></i>
                            Fa√ßa upload de um arquivo TXT existente para
                            detectar automaticamente os campos e formatar com os
                            separadores padr√µes
                        </p>
                        <button
                            type="button"
                            id="btnAnalisarModelo"
                            class="btn-secondary"
                            style="width: 100%; margin-top: 10px; display: none"
                        >
                            <i
                                class="fas fa-search"
                                style="margin-right: 8px"
                            ></i>
                            Analisar e Configurar Campos
                        </button>
                    </div>

                    <div id="listaColunas" class="lista-colunas">
                        <!-- Colunas ser√£o adicionadas dinamicamente aqui -->
                    </div>

                    <button
                        type="button"
                        id="btnAdicionarColuna"
                        class="btn-add-coluna"
                    >
                        <i class="fas fa-plus"></i> Adicionar Coluna
                    </button>

                    <div class="input-group" style="margin-top: 15px">
                        <label
                            >Campos Obrigat√≥rios (marque os campos que devem ser
                            preenchidos):</label
                        >
                        <div
                            id="checkboxesObrigatorios"
                            class="checkboxes-obrigatorios"
                        >
                            <!-- Checkboxes ser√£o adicionados dinamicamente -->
                        </div>
                    </div>

                    <div class="input-group" style="margin-top: 20px">
                        <button
                            type="button"
                            id="btnGerarModeloCustom"
                            class="btn-secondary"
                            style="width: 100%"
                        >
                            <i
                                class="fas fa-file-download"
                                style="margin-right: 8px"
                            ></i>
                            Gerar Modelo de Planilha TXT
                        </button>
                        <p
                            class="info-text"
                            style="
                                margin-top: 10px;
                                font-size: 0.85em;
                                color: var(--color-text-secondary);
                            "
                        >
                            <i
                                class="fas fa-info-circle"
                                style="margin-right: 5px"
                            ></i>
                            Gere um modelo de planilha TXT com os campos
                            configurados para preencher
                        </p>
                    </div>
                </div>

                <hr class="divider" />

                <h2>
                    <i
                        class="fas fa-calendar-alt"
                        style="margin-right: 10px; color: var(--color-primary)"
                    ></i>
                    Controle de Processamento por Dia
                </h2>

                <div class="input-group">
                    <label for="dataManual"
                        >**1. Data de Inser√ß√£o do Lote (Obrigat√≥ria):**</label
                    >
                    <div id="feedbackData" class="feedback-popup"></div>
                    <input type="date" id="dataManual" required />
                </div>

                <div class="input-group">
                    <label for="arquivoTxt"
                        >**2. Carregar Arquivo TXT do Dia:**</label
                    >
                    <input type="file" id="arquivoTxt" accept=".txt" required />
                </div>

                <button id="processarDia" disabled class="btn-primary">
                    <i class="fas fa-play-circle" style="margin-right: 8px"></i>
                    3. Processar e Adicionar Dia
                </button>

                <hr class="divider" />

                <button id="gerarPlanilhaFinal" disabled class="btn-secondary">
                    <i class="fas fa-download" style="margin-right: 8px"></i>
                    4. Gerar Planilha FINAL (CSV)
                </button>
            </section>

            <section class="log-panel">
                <h3>
                    <i
                        class="fas fa-clipboard-list"
                        style="margin-right: 10px"
                    ></i>
                    Registro de Processamento
                </h3>
                <div id="resumo" class="resumo-box">
                    <p>
                        üìä **Total de Registros Acumulados:**
                        <span id="totalRegistros">0</span>
                    </p>
                </div>
                <pre id="logArea">
Aguardando configura√ß√£o e carregamento do arquivo...</pre
                >
            </section>
        </main>

        <!-- Modal de Edi√ß√£o e An√°lise de Modelo -->
        <div id="modalEdicaoModelo" class="modal">
            <div class="modal-content" style="max-width: 1000px">
                <span class="close-button" id="btnFecharModalEdicao"
                    >&times;</span
                >
                <h2>
                    <i class="fas fa-edit" style="margin-right: 10px"></i>
                    An√°lise e Edi√ß√£o de Modelo TXT
                </h2>

                <div
                    style="
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-top: 20px;
                    "
                >
                    <!-- Painel Esquerdo: Conte√∫do Original -->
                    <div>
                        <h3 style="margin-top: 0; color: var(--color-primary)">
                            <i
                                class="fas fa-file-alt"
                                style="margin-right: 8px"
                            ></i>
                            Conte√∫do Original
                        </h3>
                        <textarea
                            id="conteudoOriginal"
                            class="textarea-edicao"
                            placeholder="Conte√∫do do arquivo aparecer√° aqui..."
                        ></textarea>
                        <button
                            type="button"
                            id="btnAplicarSeparadores"
                            class="btn-secondary"
                            style="width: 100%; margin-top: 10px"
                        >
                            <i
                                class="fas fa-magic"
                                style="margin-right: 8px"
                            ></i>
                            Aplicar Separadores Padr√µes
                        </button>
                    </div>

                    <!-- Painel Direito: Campos Detectados e Sugest√µes -->
                    <div>
                        <h3 style="margin-top: 0; color: var(--color-primary)">
                            <i
                                class="fas fa-list"
                                style="margin-right: 8px"
                            ></i>
                            Campos Detectados
                        </h3>
                        <div id="camposDetectados" class="campos-detectados">
                            <p
                                style="
                                    color: var(--color-text-secondary);
                                    font-style: italic;
                                "
                            >
                                <i
                                    class="fas fa-info-circle"
                                    style="margin-right: 5px"
                                ></i>
                                Campos ser√£o detectados automaticamente ap√≥s
                                an√°lise
                            </p>
                        </div>
                        <div
                            style="
                                margin-top: 15px;
                                padding: 15px;
                                background: #fef3c7;
                                border-radius: 8px;
                                border-left: 4px solid var(--color-accent);
                            "
                        >
                            <p
                                style="
                                    margin: 0;
                                    font-size: 0.9em;
                                    color: #92400e;
                                "
                            >
                                <strong
                                    ><i
                                        class="fas fa-lightbulb"
                                        style="margin-right: 5px"
                                    ></i
                                    >Dica:</strong
                                >
                                Use o formato "NomeCampo: valor" em cada linha.
                                Os separadores padr√µes ser√£o adicionados
                                automaticamente entre blocos.
                            </p>
                        </div>
                        <button
                            type="button"
                            id="btnAplicarCampos"
                            class="btn-primary"
                            style="width: 100%; margin-top: 15px; display: none"
                        >
                            <i
                                class="fas fa-check"
                                style="margin-right: 8px"
                            ></i>
                            Aplicar Campos √† Configura√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="modalAjuda" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>Como Usar o Conversor Mestre Unificado</h2>

                <p>
                    Este sistema permite que voc√™ consolide dados de v√°rios dias
                    em uma √∫nica planilha CSV mestra, com suporte para
                    diferentes tipos de processamento.
                </p>

                <hr />

                <h3>Tipos de Processamento:</h3>
                <ul>
                    <li>
                        <strong>CAC - Consultor:</strong> Processa dados de
                        consultores com campos espec√≠ficos.
                    </li>
                    <li>
                        <strong>CAB - Banc√°rio:</strong> Processa dados
                        banc√°rios com campos espec√≠ficos.
                    </li>
                    <li>
                        <strong>CUSTOM - Personalizado:</strong> Permite definir
                        seus pr√≥prios campos e colunas.
                    </li>
                </ul>

                <hr />

                <h3>Fluxo de Trabalho:</h3>
                <ol>
                    <li>
                        <strong>Selecione o Tipo:</strong> Escolha entre CAC,
                        CAB ou CUSTOM.
                    </li>
                    <li>
                        <strong>Configure Colunas (se CUSTOM):</strong> Defina
                        os campos que ser√£o extra√≠dos e quais s√£o obrigat√≥rios.
                    </li>
                    <li>
                        <strong>Insira a Data:</strong> No campo **1**, digite a
                        data do lote que ser√° processado.
                    </li>
                    <li>
                        <strong>Carregue o Arquivo:</strong> No campo **2**,
                        selecione o arquivo TXT correspondente.
                    </li>
                    <li>
                        <strong>Processe o Dia:</strong> Clique em **"Processar
                        e Adicionar Dia"** (**3**). A data avan√ßar√°
                        automaticamente.
                    </li>
                    <li>
                        <strong>Repita:</strong> Repita os passos para todos os
                        dias.
                    </li>
                    <li>
                        <strong>Gere o Final:</strong> Clique em **"Gerar
                        Planilha FINAL (CSV)"** (**4**) para baixar.
                    </li>
                </ol>

                <hr />

                <h3>Formato do Arquivo TXT (Obrigat√≥rio)</h3>
                <p>
                    O arquivo TXT deve seguir o modelo abaixo. Use separadores
                    <code>================</code> e <code>**********</code> para
                    delimitar blocos.
                </p>

                <div
                    style="
                        display: flex;
                        gap: 10px;
                        margin-top: 15px;
                        flex-wrap: wrap;
                    "
                >
                    <button
                        id="btnDownloadModeloCAC"
                        class="btn-secondary"
                        style="width: auto; flex: 1; min-width: 200px"
                    >
                        <i class="fas fa-download"></i> Baixar Modelo CAC
                    </button>
                    <button
                        id="btnDownloadModeloCAB"
                        class="btn-secondary"
                        style="width: auto; flex: 1; min-width: 200px"
                    >
                        <i class="fas fa-download"></i> Baixar Modelo CAB
                    </button>
                </div>

                <div id="exemploModelo" style="margin-top: 15px">
                    <!-- Exemplo ser√° carregado dinamicamente baseado no tipo selecionado -->
                </div>
            </div>
        </div>

        <script src="script.js"></script>
    </body>
</html>
